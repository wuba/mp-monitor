"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),"undefined"==typeof window?window={console:console}:window.console||(window.console=console),"undefined"==typeof navigator&&(navigator={userAgent:""}),global.console||(global.console=console);var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function __rest(e,t){var n={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]]);return n}function __values(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}var setPrototypeOf=Object.setPrototypeOf||({__proto__:[]}instanceof Array?setProtoOf:mixinProperties);function setProtoOf(e,t){return e.__proto__=t,e}function mixinProperties(e,t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n]);return e}var BeidouError$1=function(r){function e(e){var t=this.constructor,n=r.call(this,e)||this;return n.message=e,n.name=t.prototype.constructor.name,setPrototypeOf(n,t.prototype),n}return __extends(e,r),e}(Error);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dynamicRequire(e,t){return e.require(t)}function isNodeEnv(){return"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)}var fallbackGlobalObject={};function getGlobalObject$1(){return isNodeEnv()?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:fallbackGlobalObject}function uuid4$3(){var e=getGlobalObject$1(),t=e.crypto||e.msCrypto;if(void 0!==t&&t.getRandomValues){e=new Uint16Array(8);t.getRandomValues(e),e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;t=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t};return t(e[0])+t(e[1])+t(e[2])+t(e[3])+t(e[4])+t(e[5])+t(e[6])+t(e[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function consoleSandbox(e){var t=getGlobalObject$1();if(!("console"in t))return e();var n=t.console,r={};["debug","info","warn","error","log","assert"].forEach(function(e){e in t.console&&n[e].__beidou_original__&&(r[e]=n[e],n[e]=n[e].__beidou_original__)});e=e();return Object.keys(r).forEach(function(e){n[e]=r[e]}),e}function addExceptionTypeValue$1(e,t,n){e.exceptions=e.exceptions||[],e.exceptions[0]=e.exceptions[0]||{},e.exceptions[0].content=e.exceptions[0].content||n+":"+t||""}function addExceptionMechanism$1(t,n){void 0===n&&(n={});try{t.exceptions[0].mechanism=t.exceptions[0].mechanism||{},Object.keys(n).forEach(function(e){t.exceptions[0].mechanism[e]=n[e]})}catch(e){}}function getLocationHref(){try{return document.location.href}catch(e){return""}}function isDevHref(){var e=getLocationHref();return!(!e.includes("localhost")&&!e.includes("127.0.0.1"))}function htmlTreeAsString(e){try{for(var t,n=e,r=[],o=0,i=0,s=" > ".length;n&&o++<5&&!("html"===(t=_htmlElementAsString(n))||1<o&&80<=i+r.length*s+t.length);)r.push(t),i+=t.length,n=n.parentNode;return r.reverse().join(" > ")}catch(e){return"<unknown>"}}function _htmlElementAsString(e){var t,n,r,o=e,i=[];if(!o||!o.tagName)return"";if(i.push(o.tagName.toLowerCase()),o.id&&i.push("#"+o.id),(e=o.className)&&isString$1(e))for(t=e.split(/\s+/),a=0;a<t.length;a++)i.push("."+t[a]);for(var s=["type","name","title","alt"],a=0;a<s.length;a++)(r=o.getAttribute(n=s[a]))&&i.push("["+n+'="'+r+'"]');return i.join("")}var INITIAL_TIME=Date.now(),prevNow=0,performanceFallback={now:function(){var e=Date.now()-INITIAL_TIME;return prevNow=e=e<prevNow?prevNow:e},timeOrigin:INITIAL_TIME},crossPlatformPerformance=function(){if(isNodeEnv())try{return dynamicRequire(module,"perf_hooks").performance}catch(e){return performanceFallback}var e=getGlobalObject$1().performance;return e&&e.now?(void 0===e.timeOrigin&&(e.timeOrigin=e.timing&&e.timing.navigationStart||INITIAL_TIME),e):performanceFallback}();function timestampWithMs$1(){return(crossPlatformPerformance.timeOrigin+crossPlatformPerformance.now())/1e3}var defaultRetryAfter=6e4;function parseRetryAfterHeader$1(e,t){if(!t)return defaultRetryAfter;var n=parseInt(""+t,10);if(!isNaN(n))return 1e3*n;t=Date.parse(""+t);return isNaN(t)?defaultRetryAfter:t-e}var defaultFunctionName="<anonymous>";function getFunctionName$1(e){try{return e&&"function"==typeof e?e.name||defaultFunctionName:defaultFunctionName}catch(e){return defaultFunctionName}}function isError$1(e){switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return isInstanceOf$1(e,Error)}}function isErrorEvent$1(e){return"[object ErrorEvent]"===Object.prototype.toString.call(e)}function isDOMError$1(e){return"[object DOMError]"===Object.prototype.toString.call(e)}function isDOMException$1(e){return"[object DOMException]"===Object.prototype.toString.call(e)}function isString$1(e){return"[object String]"===Object.prototype.toString.call(e)}function isPrimitive(e){return null===e||"object"!==_typeof(e)&&"function"!=typeof e}function isPlainObject$2(e){return"[object Object]"===Object.prototype.toString.call(e)}function isEvent$2(e){return"undefined"!=typeof Event&&isInstanceOf$1(e,Event)}function isElement(e){return"undefined"!=typeof Element&&isInstanceOf$1(e,Element)}function isThenable(e){return Boolean(e&&e.then&&"function"==typeof e.then)}function isSyntheticEvent(e){return isPlainObject$2(e)&&"nativeEvent"in e&&"preventDefault"in e&&"stopPropagation"in e}function isInstanceOf$1(e,t){try{return e instanceof t}catch(e){return!1}}getGlobalObject$1();var global$2=getGlobalObject$1(),PREFIX="Beidou Logger ",Logger=function(){function e(){this._enabled=!1}return e.prototype.disable=function(){this._enabled=!1},e.prototype.enable=function(){this._enabled=!0},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._enabled&&consoleSandbox(function(){global$2.console.log(PREFIX+"[Log]: "+e.join(" "))})},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._enabled&&consoleSandbox(function(){global$2.console.warn(PREFIX+"[Warn]: "+e.join(" "))})},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._enabled&&consoleSandbox(function(){global$2.console.error(PREFIX+"[Error]: "+e.join(" "))})},e}();global$2.__BEIDOU__=global$2.__BEIDOU__||{};var States,logger$4=global$2.__BEIDOU__.logger||(global$2.__BEIDOU__.logger=new Logger),Memo=function(){function e(){this._hasWeakSet="function"==typeof WeakSet,this._inner=this._hasWeakSet?new WeakSet:[]}return e.prototype.memoize=function(e){if(this._hasWeakSet)return!!this._inner.has(e)||(this._inner.add(e),!1);for(var t=0;t<this._inner.length;t++)if(this._inner[t]===e)return!0;return this._inner.push(e),!1},e.prototype.unmemoize=function(e){if(this._hasWeakSet)this._inner.delete(e);else for(var t=0;t<this._inner.length;t++)if(this._inner[t]===e){this._inner.splice(t,1);break}},e}();function truncate(e,t){return void 0===t&&(t=0),"string"!=typeof e||0===t||e.length<=t?e:e.substr(0,t)+"..."}function getWalkSource(e){if(isError$1(e)){var t=e,n={message:t.message,name:t.name,stack:t.stack};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}if(isEvent$2(e)){var r,o=e,i={};i.type=o.type;try{i.target=isElement(o.target)?htmlTreeAsString(o.target):Object.prototype.toString.call(o.target)}catch(e){i.target="<unknown>"}try{i.currentTarget=isElement(o.currentTarget)?htmlTreeAsString(o.currentTarget):Object.prototype.toString.call(o.currentTarget)}catch(e){i.currentTarget="<unknown>"}for(r in"undefined"!=typeof CustomEvent&&isInstanceOf$1(e,CustomEvent)&&(i.detail=o.detail),o)Object.prototype.hasOwnProperty.call(o,r)&&(i[r]=o);return i}return e}function serializeValue(e){var t=Object.prototype.toString.call(e);if("string"==typeof e)return e;if("[object Object]"===t)return"[Object]";if("[object Array]"===t)return"[Array]";e=normalizeValue(e);return isPrimitive(e)?e:t}function normalizeValue(e,t){return"domain"===t&&e&&"object"===_typeof(e)&&e._events?"[Domain]":"domainEmitter"===t?"[DomainEmitter]":"undefined"!=typeof global&&e===global?"[Global]":"undefined"!=typeof window&&e===window?"[Window]":"undefined"!=typeof document&&e===document?"[Document]":isSyntheticEvent(e)?"[SyntheticEvent]":"number"==typeof e&&e!=e?"[NaN]":void 0===e?"[undefined]":"function"==typeof e?"[Function: "+getFunctionName$1(e)+"]":e}function walk(e,t,n,r){if(void 0===n&&(n=1/0),void 0===r&&(r=new Memo),0===n)return serializeValue(t);if(null!=t&&"function"==typeof t.toJSON)return t.toJSON();e=normalizeValue(t,e);if(isPrimitive(e))return e;var o,i=getWalkSource(t),s=Array.isArray(t)?[]:{};if(r.memoize(t))return"[Circular ~]";for(o in i)Object.prototype.hasOwnProperty.call(i,o)&&(s[o]=walk(o,i[o],n-1,r));return r.unmemoize(t),s}function normalize(e,n){try{return JSON.parse(JSON.stringify(e,function(e,t){return walk(e,t,n)}))}catch(e){return"**non-serializable**"}}function extractExceptionKeysForMessage$1(e,t){void 0===t&&(t=40);var n=Object.keys(getWalkSource(e));if(n.sort(),!n.length)return"[object has no keys]";if(n[0].length>=t)return truncate(n[0],t);for(var r=n.length;0<r;r--){var o=n.slice(0,r).join(", ");if(!(o.length>t))return r===n.length?o:truncate(o,t)}return""}function intercept$1(e,t,n){var r;if(t in e){n=n(e[t]);if("function"==typeof n)try{Object.defineProperties(e,((r={})[t]={enumerable:!1,value:n},r))}catch(e){}else e[t]=n}}!function(e){e.PENDING="PENDING",e.RESOLVED="RESOLVED",e.REJECTED="REJECTED"}(States=States||{});var SyncPromise$1=function(){function s(e){var n=this;this._state=States.PENDING,this._handlers=[],this._resolve=function(e){n._setResult(States.RESOLVED,e)},this._reject=function(e){n._setResult(States.REJECTED,e)},this._setResult=function(e,t){n._state===States.PENDING&&(isThenable(t)?t.then(n._resolve,n._reject):(n._state=e,n._value=t,n._executeHandlers()))},this._attachHandler=function(e){n._handlers=n._handlers.concat(e),n._executeHandlers()},this._executeHandlers=function(){var e;n._state!==States.PENDING&&(e=n._handlers.slice(),n._handlers=[],e.forEach(function(e){e.done||(n._state===States.RESOLVED&&e.onfulfilled&&e.onfulfilled(n._value),n._state===States.REJECTED&&e.onrejected&&e.onrejected(n._value),e.done=!0)}))};try{e(this._resolve,this._reject)}catch(e){this._reject(e)}}return s.resolve=function(t){return new s(function(e){e(t)})},s.reject=function(n){return new s(function(e,t){t(n)})},s.all=function(e){return new s(function(n,r){var o,i;Array.isArray(e)?0!==e.length?(o=e.length,i=[],e.forEach(function(e,t){s.resolve(e).then(function(e){i[t]=e,0===--o&&n(i)}).then(null,r)})):n([]):r(new TypeError("Promise.all requires an array as input."))})},s.prototype.then=function(r,o){var e=this;return new s(function(t,n){e._attachHandler({done:!1,onfulfilled:function(e){if(r)try{return void t(r(e))}catch(e){return void n(e)}else t(e)},onrejected:function(e){if(o)try{return void t(o(e))}catch(e){return void n(e)}else n(e)}})})},s.prototype.catch=function(e){return this.then(function(e){return e},e)},s.prototype.finally=function(o){var i=this;return new s(function(e,t){var n,r;return i.then(function(e){r=!1,n=e,o&&o()},function(e){r=!0,n=e,o&&o()}).then(function(){(r?t:e)(n)})})},s.prototype.toString=function(){return"[object SyncPromise]"},s}(),PromiseBuffer$1=function(){function e(e){this._limit=e,this._buffer=[]}return e.prototype.isReady=function(){return void 0===this._limit||this.length()<this._limit},e.prototype.add=function(e){var t=this;return this.isReady()?(-1===this._buffer.indexOf(e)&&this._buffer.push(e),e.then(function(){return t.remove(e)}).then(null,function(){return t.remove(e).then(null,function(){})}),e):SyncPromise$1.reject(new BeidouError$1("Not adding Promise due to buffer limit reached."))},e.prototype.remove=function(e){return this._buffer.splice(this._buffer.indexOf(e),1)[0]},e.prototype.length=function(){return this._buffer.length},e.prototype.drain=function(n){var r=this;return new SyncPromise$1(function(e){var t=setTimeout(function(){n&&0<n&&e(!1)},n);SyncPromise$1.all(r._buffer).then(function(){clearTimeout(t),e(!0)}).then(null,function(){e(!0)})})},e}(),oldUrlObj={method:"",url:""};function repeatCheck$1(e,t){e={method:e,url:t},t=objEqual(oldUrlObj,e);return t||(oldUrlObj=__assign({},e)),t}function objEqual(e,t){for(var n in e){if(!t.hasOwnProperty(n))return!1;if(e[n]!==t[n])return!1}return!0}var Scope=function(){function n(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._extra={},this._contexts={}}return n.clone=function(e){var t=new n;return e&&(t._breadcrumbs=__spread(e._breadcrumbs),t._extra=__assign({},e._extra),t._contexts=__assign({},e._contexts),t._span=e._span,t._transactionName=e._transactionName,t._eventProcessors=__spread(e._eventProcessors)),t},n.prototype.addScopeListener=function(e){this._scopeListeners.push(e)},n.prototype.addEventProcessor=function(e){return this._eventProcessors.push(e),this},n.prototype.setTransactionName=function(e){return this._transactionName=e,this._notifyScopeListeners(),this},n.prototype.setTransaction=function(e){return this.setTransactionName(e)},n.prototype.setContext=function(e,t){var n;return this._contexts=__assign(__assign({},this._contexts),((n={})[e]=t,n)),this._notifyScopeListeners(),this},n.prototype.setSpan=function(e){return this._span=e,this._notifyScopeListeners(),this},n.prototype.getSpan=function(){return this._span},n.prototype.getTransaction=function(){var e=this.getSpan();if(e&&e.spanRecorder&&e.spanRecorder.spans[0])return e.spanRecorder.spans[0]},n.prototype.getBreadcrumb=function(){return this._breadcrumbs},n.prototype.update=function(e){if(!e)return this;if("function"!=typeof e)return e instanceof n?(this._extra=__assign(__assign({},this._extra),e._extra),this._contexts=__assign(__assign({},this._contexts),e._contexts)):isPlainObject$2(e)&&(this._extra=__assign(__assign({},this._extra),e.extra),this._contexts=__assign(__assign({},this._contexts),e.contexts)),this;e=e(this);return e instanceof n?e:this},n.prototype.clear=function(){return this._breadcrumbs=[],this._extra={},this._contexts={},this._transactionName=void 0,this._span=void 0,this._notifyScopeListeners(),this},n.prototype.addBreadcrumb=function(e,t){e=__assign({timestamp:timestampWithMs$1()},e);return this._breadcrumbs=void 0!==t&&0<=t?__spread(this._breadcrumbs,[e]).slice(-t):__spread(this._breadcrumbs,[e]),this._notifyScopeListeners(),this},n.prototype.clearBreadcrumbs=function(){return this._breadcrumbs=[],this._notifyScopeListeners(),this},n.prototype.applyToEvent=function(e,t){return this._contexts&&Object.keys(this._contexts).length&&(e.contexts=__assign(__assign({},this._contexts),e.contexts)),this._notifyEventProcessors(__spread(getGlobalEventProcessors(),this._eventProcessors),e,t)},n.prototype._notifyEventProcessors=function(r,o,i,s){var a=this;return void 0===s&&(s=0),new SyncPromise$1(function(t,e){var n=r[s];null===o||"function"!=typeof n?t(o):(isThenable(n=n(__assign({},o),i))?n.then(function(e){return a._notifyEventProcessors(r,e,i,s+1).then(t)}):a._notifyEventProcessors(r,n,i,s+1).then(t)).then(null,e)})},n.prototype._notifyScopeListeners=function(){var t=this;this._notifyingListeners||(this._notifyingListeners=!0,setTimeout(function(){t._scopeListeners.forEach(function(e){e(t)}),t._notifyingListeners=!1}))},n}();function getGlobalEventProcessors(){var e=getGlobalObject$1();return e.__BEIDOU__=e.__BEIDOU__||{},e.__BEIDOU__.globalEventProcessors=e.__BEIDOU__.globalEventProcessors||[],e.__BEIDOU__.globalEventProcessors}function addGlobalEventProcessor$1(e){getGlobalEventProcessors().push(e)}var EventTypeEnum,LogLevel,Severity,Status,DEFAULT_BREADCRUMBS=100,MAX_BREADCRUMBS=100,Hub=function(){function e(e,t){void 0===t&&(t=new Scope),this._stack=[],this._stack.push({client:e,scope:t}),this.bindClient(e)}return e.prototype.bindClient=function(e){(this.getStackTop().client=e)&&e.setupIntegrations&&e.setupIntegrations()},e.prototype.pushScope=function(){var e=this.getStack(),e=0<e.length?e[e.length-1].scope:void 0,e=Scope.clone(e);return this.getStack().push({client:this.getClient(),scope:e}),e},e.prototype.popScope=function(){return void 0!==this.getStack().pop()},e.prototype.withScope=function(e){var t=this.pushScope();try{e(t)}finally{this.popScope()}},e.prototype.getClient=function(){return this.getStackTop().client},e.prototype.getScope=function(){return this.getStackTop().scope},e.prototype.getStack=function(){return this._stack},e.prototype.getStackTop=function(){return this._stack[this._stack.length-1]},e.prototype.captureException=function(e,t){var n=this._lastEventId=uuid4$3(),r=t;if(!t){t=void 0;try{throw new Error("Beidou syntheticException")}catch(e){t=e}r={originalException:e,syntheticException:t}}return this._invokeClient("captureException",e,__assign({timestamp:Date.now(),event_id:n},r)),n},e.prototype.captureEvent=function(e,t){var n=this._lastEventId=uuid4$3();return this._invokeClient("captureEvent",e,__assign({timestamp:Date.now(),event_id:n},t)),n},e.prototype.lastEventId=function(){return this._lastEventId},e.prototype.addBreadcrumb=function(e,t){var n,r,o,i,s=this.getStackTop();s.scope&&s.client&&(o=(r=s.client.getOptions&&s.client.getOptions()||{}).beforeBreadcrumb,n=void 0===o?null:o,(r=void 0===(o=r.maxBreadcrumbs)?DEFAULT_BREADCRUMBS:o)<=0||(o=timestampWithMs$1(),i=__assign({timestamp:o},e),null!==(e=n?consoleSandbox(function(){return n(i,t)}):i)&&s.scope.addBreadcrumb(e,Math.min(r,MAX_BREADCRUMBS))))},e.prototype.setContext=function(e,t){var n=this.getStackTop();n.scope&&n.scope.setContext(e,t)},e.prototype.configureScope=function(e){var t=this.getStackTop();t.scope&&t.client&&e(t.scope)},e.prototype.getIntegration=function(t){var e=this.getClient();if(!e)return null;try{return e.getIntegration(t)}catch(e){return logger$4.warn("Cannot retrieve integration "+t.id+" from the current Hub"),null}},e.prototype.startSpan=function(e){return this._callExtensionMethod("startSpan",e)},e.prototype.startTransaction=function(e){return this._callExtensionMethod("startTransaction",e)},e.prototype._invokeClient=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=this.getStackTop();o&&o.client&&o.client[e]&&(t=o.client)[e].apply(t,__spread(n,[o.scope]))},e.prototype._callExtensionMethod=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=getMainCarrier().__BEIDOU__;if(r&&r.extensions&&"function"==typeof r.extensions[e])return r.extensions[e].apply(this,t);logger$4.warn("Extension method "+e+" couldn't be found, doing nothing.")},e}();function getMainCarrier(){var e=getGlobalObject$1();return e.__BEIDOU__=e.__BEIDOU__||{extensions:{},hub:void 0},e}function getCurrentHub$6(){var e=getMainCarrier();return hasHubOnCarrier(e)||setHubOnCarrier(e,new Hub),getHubFromCarrier(e)}function hasHubOnCarrier(e){return!!(e&&e.__BEIDOU__&&e.__BEIDOU__.hub)}function getHubFromCarrier(e){return e&&e.__BEIDOU__&&e.__BEIDOU__.hub||(e.__BEIDOU__=e.__BEIDOU__||{},e.__BEIDOU__.hub=new Hub),e.__BEIDOU__.hub}function setHubOnCarrier(e,t){return!!e&&(e.__BEIDOU__=e.__BEIDOU__||{},e.__BEIDOU__.hub=t,!0)}!function(e){e.resource="resource",e.api="api",e.api_rate="api_rate",e.exception="exception",e.performance="performance",e.breadcrumb="breadcrumb"}(EventTypeEnum=EventTypeEnum||{}),function(e){e[e.None=0]="None",e[e.Error=1]="Error",e[e.Debug=2]="Debug",e[e.Verbose=3]="Verbose"}(LogLevel=LogLevel||{}),function(e){e.Fatal="fatal",e.Error="error",e.Warning="warning",e.Log="log",e.Info="info",e.Debug="debug",e.Critical="critical"}(Severity=Severity||{}),function(t){t.fromString=function(e){switch(e){case"debug":return t.Debug;case"info":return t.Info;case"warn":case"warning":return t.Warning;case"error":return t.Error;case"fatal":return t.Fatal;case"critical":return t.Critical;default:return t.Log}}}(Severity=Severity||{}),function(e){e.Unknown="unknown",e.Skipped="skipped",e.Success="success",e.RateLimit="rate_limit",e.Invalid="invalid",e.Failed="failed"}(Status=Status||{}),function(t){t.fromHttpCode=function(e){return 200<=e&&e<300?t.Success:429===e?t.RateLimit:400<=e&&e<500?t.Invalid:500<=e?t.Failed:t.Unknown}}(Status=Status||{});var installedIntegrations=[];function setupIntegration(e){-1===installedIntegrations.indexOf(e.name)&&(e.setupOnce(addGlobalEventProcessor$1,getCurrentHub$6),installedIntegrations.push(e.name),logger$4.log("Integration installed: "+e.name))}function setupIntegrations(e){var t={};return Array.isArray(e.defaultIntegrations)&&e.defaultIntegrations.length&&e.defaultIntegrations.forEach(function(e){setupIntegration(t[e.name]=e)}),t}var DEFAULT_MAX_COUNT=25,BaseClient=function(){function e(e,t){this._integrations={},this._processing=!1,this._count=DEFAULT_MAX_COUNT,this._backend=new e(t),this._options=t}return e.prototype.captureException=function(e,t,n){var r=this,o=t&&t.event_id;return this._processing=!0,this._getBackend().eventFromException(e,t).then(function(e){e.type=EventTypeEnum.exception,o=r.captureEvent(e,t,n)}),o},e.prototype._devEnvHandle=function(){return isDevHref()&&logger$4.warn("监控你在本地服务进行开发，不会进行北斗上报"),!0},e.prototype._limitCount=function(e){return"breadcrumb"===e.type||(this._count<=0?(logger$4.warn("当前发送次数已经用完"),!1):(logger$4.log("当前剩余发送event次数: "+this._count),this._count=this._count-1,!0))},e.prototype.captureEvent=function(e,t,n){var r=this,o=t&&t.event_id;return this._processing=!0,this._processEvent(e,t,n).then(function(e){o=e&&e.event_id,r._processing=!1}).then(null,function(e){r._processing=!1}),o},e.prototype.getOptions=function(){return this._options},e.prototype.setupIntegrations=function(){this._isEnabled()&&(this._integrations=setupIntegrations(this._options))},e.prototype.getIntegration=function(t){try{return this._integrations[t.id]||null}catch(e){return logger$4.warn("Cannot retrieve integration "+t.id+" from the current Client"),null}},e.prototype._getBackend=function(){return this._backend},e.prototype._isEnabled=function(){return!1!==this.getOptions().enabled},e.prototype._isProd=function(){return!!this.getOptions().isProd},e.prototype._isDebug=function(){return!!this.getOptions().isDebug},e.prototype._prepareEvent=function(e,t,n){var r=this,o=this.getOptions().normalizeDepth,i=void 0===o?3:o,o=__assign({},e);this._applyClientOptions(o);e=t;n&&n.captureContext&&(e=Scope.clone(e).update(n.captureContext));t=SyncPromise$1.resolve(o);return(t=e?e.applyToEvent(o,n):t).then(function(e){return"number"==typeof i&&0<i?r._normalizeEvent(e,i):e})},e.prototype._normalizeEvent=function(e,t){if(!e)return null;t=__assign(__assign({},e),e.contexts&&{contexts:normalize(e.contexts,t)});return e.contexts&&e.contexts.trace&&(t.contexts.trace=e.contexts.trace),t},e.prototype._applyClientOptions=function(e){var t=this.getOptions().maxValueLength,n=void 0===t?250:t,t=e.exceptions&&e.exceptions[0];t&&t.content&&(t.content=truncate(t.content,n));e=e.request;e&&e.url&&(e.url=truncate(e.url,n))},e.prototype._sendEvent=function(e){this._isProd()&&this._devEnvHandle()&&this._limitCount(e)&&this._getBackend().sendEvent(e),this._isDebug()&&logger$4.log("1",JSON.stringify(e))},e.prototype._processEvent=function(e,o,t){var i=this,s=this.getOptions().beforeSend;return this._isEnabled()?new SyncPromise$1(function(n,r){i._prepareEvent(e,t,o).then(function(e){if(null!==e){var t=e;if(o&&o.data&&!0===o.data.__beidou__||!s)return i._sendEvent(t),void n(t);e=s(e,o);if(void 0===e)logger$4.error("`beforeSend` method has to return `null` or a valid event.");else if(isThenable(e))i._handleAsyncBeforeSend(e,n,r);else{if(null===(t=e))return logger$4.log("`beforeSend` returned `null`, will not send event."),void n(null);i._sendEvent(t),n(t)}}else r("An event processor returned null, will not send event.")}).then(null,function(e){i.captureException(e,{data:{__beidou__:!0},originalException:e}),r("Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: "+e)})}):SyncPromise$1.reject("SDK not enabled, will not send event.")},e.prototype._handleAsyncBeforeSend=function(e,t,n){var r=this;e.then(function(e){null!==e?(r._sendEvent(e),t(e)):n("`beforeSend` returned `null`, will not send event.")}).then(null,function(e){n("beforeSend rejected with "+e)})},e}(),NoopTransport=function(){function e(){}return e.prototype.sendEvent=function(e){return SyncPromise$1.resolve({reason:"NoopTransport: Event has been skipped",status:Status.Skipped})},e.prototype.close=function(e){return SyncPromise$1.resolve(!0)},e}(),BaseBackend=function(){function e(e){this._options=e,this._transport=this._setupTransport()}return e.prototype.eventFromException=function(e,t){throw new BeidouError$1("Backend has to implement `eventFromException` method")},e.prototype.eventFromMessage=function(e,t){throw new BeidouError$1("Backend has to implement `eventFromMessage` method")},e.prototype.sendEvent=function(e){this._transport.sendEvent(e).then(null,function(e){logger$4.error("Error while sending event: "+e)})},e.prototype.getTransport=function(){return this._transport},e.prototype._setupTransport=function(){return new NoopTransport},e}();function initAndBind$1(e,t){!0===t.isDebug&&logger$4.enable();var n=getCurrentHub$6(),t=new e(t);n.bindClient(t)}var mp,PromiseBuffer=PromiseBuffer$1,BeidouError=BeidouError$1,getCurrentHub$5=getCurrentHub$6,BaseTransport=function(){function e(){this.url="",this._buffer=new PromiseBuffer(30)}return e.prototype._getReportUrl=function(){return(getCurrentHub$5().getClient()||{getOptions:function(){return{projectId:"",url:""}}}).getOptions().url},e.prototype.sendEvent=function(e){throw new BeidouError("Transport Class has to implement `sendEvent` method")},e.prototype.close=function(e){return this._buffer.drain(e)},e.prototype.finalFomartData=function(e){var t=e.projectId,n=e.exceptions,r=e.apis,o=e.resources,i=e.performances,s=e.breadcrumbs,a=e.type,c=e.sdk,e=e.request,s=__assign(__assign(__assign(__assign(__assign({projectId:t,type:a,sdk:c,request:e},i&&{performances:i}),n&&{exceptions:n}),r&&{apis:r}),o&&{resources:o}),s&&{breadcrumbs:s});if("exception"===s.type&&s.exceptions&&s.exceptions[0]&&s.exceptions[0].stacktrace)try{s.exceptions[0].stacktrace=JSON.stringify(s.exceptions[0].stacktrace)}catch(e){s.exceptions[0].stacktrace="[]"}return s},e}(),APP_LIFE_CYCLE=["onLaunch","onShow"],PAGE_LIFE_CYCLE=["onLoad","onShow","onReady","onHide"],MP=function(){function e(){}return Object.defineProperty(e.prototype,"context",{get:function(){return this._context||("undefined"!=typeof wx&&(this._context=wx),"undefined"!=typeof swan&&(this._context=swan),"undefined"!=typeof tt&&(this._context=tt),"undefined"!=typeof my&&(this._context=my),"undefined"!=typeof qq&&(this._context=qq),"undefined"!=typeof qh&&(this._context=qh),this._context)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appName",{get:function(){return this._appName||("undefined"!=typeof wx&&(this._appName="wx"),"undefined"!=typeof swan&&(this._appName="swan"),"undefined"!=typeof tt&&(this._appName="tt"),"undefined"!=typeof my&&(this._appName="my"),"undefined"!=typeof qq&&(this._appName="qq"),"undefined"!=typeof qh&&(this._appName="qh"),this._appName)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"systemInfo",{get:function(){return this._systemInfo||(this._systemInfo=this._context.getSystemInfoSync(),this._systemInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userInfo",{get:function(){var t=this;if(this._userInfo)return this._userInfo;this._context.getUserInfo({success:function(e){t._userInfo=e.userInfo||{}}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"networkInfo",{get:function(){var t=this;if(this._networkInfo)return this._networkInfo;this._context.getNetworkType({success:function(e){t._networkInfo={signalStrength:e.signalStrength,networkType:e.networkType}}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sceneInfo",{get:function(){return this._sceneInfo},set:function(e){this._sceneInfo=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indexPage",{get:function(){return this._indexPage},set:function(e){this._indexPage=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentPage",{get:function(){if("qh"===this.appName)return $router.history.current.path;var e=getCurrentPages();return 0<e.length?e[e.length-1].route:this._indexPage},enumerable:!1,configurable:!0}),e.instance=function(){return mp=mp||new e},e}(),logger$3=logger$4,parseRetryAfterHeader=parseRetryAfterHeader$1,RequestTransport=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._disabledUntil=new Date(Date.now()),e}return __extends(e,t),e.prototype.sendEvent=function(e){var s=this;if(new Date(Date.now())<this._disabledUntil)return Promise.reject({event:e,reason:"Transport locked till "+this._disabledUntil+" due to too many requests.",status:429});var t=this.finalFomartData(e),n=MP.instance().context;return this.url=this._getReportUrl(),this._buffer.add(new Promise(function(o,i){n.request({url:s.url,method:"POST",header:{"content-type":"multipart/form-data; boundary=XXX"},data:'\r\n--XXX\r\nContent-Disposition: form-data; name="content"\r\n\r\n'+JSON.stringify(t)+"\r\n--XXX",success:function(e){var t,n,r=Status.fromHttpCode(e.status);r!==Status.Success?(r===Status.RateLimit&&(t=Date.now(),n=e.headers.get("Retry-After"),s._disabledUntil=new Date(t+parseRetryAfterHeader(t,n)),logger$3.warn("Too many requests, backing off till: "+s._disabledUntil)),i(e)):o({status:r})},fail:function(e){i(e)}})}))},e}(BaseTransport),UNKNOWN_FUNCTION="?",chrome=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,gecko=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:file|https?|blob|chrome|webpack|resource|moz-extension).*?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js))(?::(\d+))?(?::(\d+))?\s*$/i,winjs=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,geckoEval=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,chromeEval=/\((\S*)(?::(\d+))(?::(\d+))\)/,reactMinifiedRegexp=/Minified React error #\d+;/i;function computeStackTrace(e){var t=null,n=0;e&&("number"==typeof e.framesToPop?n=e.framesToPop:reactMinifiedRegexp.test(e.message)&&(n=1));try{if(t=computeStackTraceFromStacktraceProp(e))return popFrames(t,n)}catch(e){}try{if(t=computeStackTraceFromStackProp(e))return popFrames(t,n)}catch(e){}return{message:extractMessage(e),name:e&&e.name,stack:[],failed:!0}}function computeStackTraceFromStackProp(e){if(!e||!e.stack)return null;for(var t,n,r=[],o=e.stack.split("\n"),i=0;i<o.length;++i){if(n=chrome.exec(o[i])){var s=n[2]&&0===n[2].indexOf("native");n[2]&&0===n[2].indexOf("eval")&&(t=chromeEval.exec(n[2]))&&(n[2]=t[1],n[3]=t[2],n[4]=t[3]),s={url:n[2]&&0===n[2].indexOf("address at ")?n[2].substr("address at ".length):n[2],func:n[1]||UNKNOWN_FUNCTION,args:s?[n[2]]:[],line:n[3]?+n[3]:null,column:n[4]?+n[4]:null}}else if(n=winjs.exec(o[i]))s={url:n[2],func:n[1]||UNKNOWN_FUNCTION,args:[],line:+n[3],column:n[4]?+n[4]:null};else{if(!(n=gecko.exec(o[i])))continue;n[3]&&-1<n[3].indexOf(" > eval")&&(t=geckoEval.exec(n[3]))?(n[1]=n[1]||"eval",n[3]=t[1],n[4]=t[2],n[5]=""):0!==i||n[5]||void 0===e.columnNumber||(r[0].column=e.columnNumber+1),s={url:n[3],func:n[1]||UNKNOWN_FUNCTION,args:n[2]?n[2].split(","):[],line:n[4]?+n[4]:null,column:n[5]?+n[5]:null}}!s.func&&s.line&&(s.func=UNKNOWN_FUNCTION),r.push(s)}return r.length?{message:extractMessage(e),name:e.name,stack:r}:null}function computeStackTraceFromStacktraceProp(e){if(!e||!e.stacktrace)return null;for(var t,n=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,r=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^)]+))\((.*)\))? in (.*):\s*$/i,o=e.stacktrace.split("\n"),i=[],s=0;s<o.length;s+=2){var a=null;(t=n.exec(o[s]))?a={url:t[2],func:t[3],args:[],line:+t[1],column:null}:(t=r.exec(o[s]))&&(a={url:t[6],func:t[3]||t[4],args:t[5]?t[5].split(","):[],line:+t[1],column:+t[2]}),a&&(!a.func&&a.line&&(a.func=UNKNOWN_FUNCTION),i.push(a))}return i.length?{message:extractMessage(e),name:e.name,stack:i}:null}function popFrames(t,e){try{return __assign(__assign({},t),{stack:t.stack.slice(e)})}catch(e){return t}}function extractMessage(e){e=e&&e.message;return e?e.error&&"string"==typeof e.error.message?e.error.message:e:"No error message"}var extractExceptionKeysForMessage=extractExceptionKeysForMessage$1,isEvent$1=isEvent$2,STACKTRACE_LIMIT=50;function exceptionFromStacktrace(e){var t=prepareFramesForEvent(e.stack),n=e.name,r=e.message,e={content:n+":"+r};return t&&t.length&&(e.stacktrace=t),void 0===n&&""===r&&(e.content="Unrecoverable error caught"),e}function eventFromPlainObject(e,t,n){e={exceptions:[{content:(isEvent$1(e)?e.constructor.name:n?"UnhandledRejection":"Error")+":"+("Non-Error "+(n?"promise rejection":"exception")+" captured with keys is "+extractExceptionKeysForMessage(e))}]};return t&&(t=prepareFramesForEvent(computeStackTrace(t).stack),e.stacktrace={frames:t}),e}function eventFromStacktrace(e){return{exceptions:[exceptionFromStacktrace(e)]}}function prepareFramesForEvent(e){if(!e||!e.length)return[];var t=e,n=t[0].func||"",e=t[t.length-1].func||"";return-1===n.indexOf("captureMessage")&&-1===n.indexOf("captureException")||(t=t.slice(1)),(t=-1!==e.indexOf("beidouWrapped")?t.slice(0,-1):t).slice(0,STACKTRACE_LIMIT).map(function(e){return{colno:null===e.column?void 0:e.column,filename:e.url||t[0].url,function:e.func||"?",lineno:null===e.line?void 0:e.line}}).reverse()}var addExceptionMechanism=addExceptionMechanism$1,addExceptionTypeValue=addExceptionTypeValue$1,isDOMError=isDOMError$1,isDOMException=isDOMException$1,isError=isError$1,isErrorEvent=isErrorEvent$1,isEvent=isEvent$2,isPlainObject$1=isPlainObject$2,SyncPromise=SyncPromise$1;function eventFromException(e,t,n){e=eventFromUnknownInput(t,n&&n.syntheticException||void 0,{attachStacktrace:e.attachStacktrace});return SyncPromise.resolve(e)}function eventFromUnknownInput(e,t,n){if(void 0===n&&(n={}),isErrorEvent(e)&&e.error)return i=eventFromStacktrace(computeStackTrace(e=e.error));if(isDOMError(e)||isDOMException(e)){var r=e,o=r.name||(isDOMError(r)?"DOMError":"DOMException"),o=r.message?o+": "+r.message:o,i=eventFromString(o,t,n);return addExceptionTypeValue(i,o),i}return isError(e)?i=eventFromStacktrace(computeStackTrace(e)):isPlainObject$1(e)||isEvent(e)?i=eventFromPlainObject(e,t,n.rejection):(i=eventFromString(e,t,n),addExceptionTypeValue(i,""+e,void 0),addExceptionMechanism(i,{synthetic:!0}),i)}function eventFromString(e,t,n){void 0===n&&(n={});var r,o=e,e=e.match(/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i);e&&(r=e[1],o=e[2]);o={content:(r||"Error")+":"+o};return n.attachStacktrace&&t&&(t=computeStackTrace(t),o.stacktrace=prepareFramesForEvent(t.stack)),{exceptions:[o]}}var uuid,MiniProgramBackend=function(n){function e(e){var t=n.call(this,e)||this;return t._options=e,t.options=e,t}return __extends(e,n),e.prototype.eventFromException=function(e,t){return eventFromException(this.options,e,t)},e.prototype.sendEvent=function(e){this._transport.sendEvent(e).then(null,function(e){console.warn("Error while sending event: "+e)})},e.prototype._setupTransport=function(){return new RequestTransport},e}(BaseBackend),MiniProgramClient=function(t){function e(e){return t.call(this,MiniProgramBackend,e=void 0===e?{url:""}:e)||this}return __extends(e,t),e}(BaseClient),SDK_NAME="mp_monitor",SDK_VERSION="0.0.1",uuid4$2=uuid4$3,logger$2=logger$4,getCurrentHub$4=getCurrentHub$6,addGlobalEventProcessor=addGlobalEventProcessor$1;function singleUUID(){return uuid=uuid||uuid4$2()}function parseData(e){return(e=void 0===e?[]:e).map(function(e){return __assign(__assign({eventId:uuid4$2()},e),{timestamp:Date.now()})})}var Common=function(){function e(){this.name=e.id,this.setupOnce=function(){var s=(getCurrentHub$4().getClient()||{getOptions:function(){return{projectId:""}}}).getOptions().projectId;addGlobalEventProcessor(function(e){try{e.projectId=s,e.sdk={name:SDK_NAME,version:SDK_VERSION};var t=MP.instance(),n=t.systemInfo||"",r=t.networkInfo||"",o=t.sceneInfo||"",i=t.userInfo||"";e.request={url:t.currentPage,headers:{appName:t.appName,appVersion:n.version,appSDKVersion:n.SDKVersion,imei:singleUUID(),uuid:singleUUID(),pid:singleUUID(),os:n.system.split(" ")[0],osv:n.system.split(" ")[1],device:n.model,brand:n.brand,benchmarkLevel:n.benchmarkLevel,host:n.host,apn:""!==r?r.networkType:"",scene:""!==o?o.scene:"",systemInfo:encodeURIComponent(JSON.stringify(n)),userInfo:encodeURIComponent(JSON.stringify(i)),networkInfo:encodeURIComponent(JSON.stringify(r)),sceneInfo:encodeURIComponent(JSON.stringify(o))}},e.apis&&(e.apis=parseData(e.apis)),e.resources&&(e.resources=parseData(e.resources)),e.performances&&(e.performances=parseData(e.performances))}catch(e){logger$2.warn("get commom error ")}return e})}}return e.id="Common",e}(),logger$1=logger$4,getFunctionName=getFunctionName$1,intercept=intercept$1,handlers={},instrumented={};function instrument(e){var t=MP.instance().context;if(!instrumented[e])switch(instrumented[e]=!0,e){case"request":instrumentRequest(t);break;case"resource":instrumentResource(t);break;case"error":instrumentConsoleError();break;default:logger$1.warn("unknown instrumentation type:",e)}}function addInstrumentationHandler(e){e&&"string"==typeof e.type&&"function"==typeof e.callback&&(handlers[e.type]=handlers[e.type]||[],handlers[e.type].push(e.callback),instrument(e.type))}function triggerHandlers(t,e){var n,r;if(t&&handlers[t])try{for(var o=__values(handlers[t]||[]),i=o.next();!i.done;i=o.next()){var s=i.value;try{s(e)}catch(e){logger$1.error("Error while triggering instrumentation handler.\nType: "+t+"\nName: "+getFunctionName(s)+"\nError: "+e)}}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}function instrumentRequest(i){intercept(i,"request",function(o){return function(e){var t=__assign(__assign({},e),{startTimestamp:Date.now()}),n=e.success,r=e.fail;return e.success=function(e){n&&n(e),triggerHandlers("request",__assign(__assign({},t),{endTimestamp:Date.now(),response:e}))},e.fail=function(e){r&&r(e),triggerHandlers("request",__assign(__assign({},t),{endTimestamp:Date.now(),error:e}))},o.call(i,e)}})}function instrumentConsoleError(){intercept(window.console,"error",function(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return triggerHandlers("error",e),n.call(window.console,e)}})}function instrumentResource(o){intercept(o,"downloadFile",function(e){return function(t){var n=t.success,r=t.fail;return t.success=function(e){n&&n(e),200!==e.statusCode&&triggerHandlers("resource",{statusCode:e.statusCode,errMsg:e.errMsg,url:t.url||""})},t.fail=function(e){r&&r(e),triggerHandlers("resource",{errMsg:e.errMsg,url:t.url||""})},e.call(o,t)}})}var uuid4$1=uuid4$3,getGlobalObject=getGlobalObject$1,repeatCheck=repeatCheck$1,isString=isString$1,getCurrentHub$3=getCurrentHub$6,hub$2=getCurrentHub$6(),global$1=getGlobalObject(),overtime=1e4,ApiError=function(){function e(){var n=this;this.name=e.id,this.setupOnce=function(){addInstrumentationHandler({callback:n._fetchApi,type:"request"})},this._fetchApi=function(e){var t;e.endTimestamp&&(e.response||(e.response={statusCode:-1}),n._filterUrl(e.url,e.method)||repeatCheck(e.method,e.url)||(t={apis:[{category:"xhr",method:isString(e.method)?e.method.toUpperCase():"GET",url:n._formatUrl(e.url),statusCode:null===(t=null==e?void 0:e.response)||void 0===t?void 0:t.statusCode,errMsg:null===(t=null==e?void 0:e.error)||void 0===t?void 0:t.errMsg,eventId:uuid4$1(),timestamp:Date.now()}],type:"api"},(400<=e.response.statusCode||-1===e.response.statusCode)&&hub$2.captureEvent(__assign({},t)),n._handleOvertime(e,t)))},this._handleOvertime=function(e,t){e&&e.endTimestamp-e.startTimestamp>overtime&&(t.apis[0].statusCode=408,hub$2.captureEvent(__assign({},t)))},this._filterUrl=function(t,e){if(t.match(/tzjybeidou\.58\.com/)&&"POST"===e)return!0;if(t.match(/\.(png|jpe?g|gif)$/))return!0;var e=hub$2.getClient(),e=e?e.getOptions():{},n=!1;return e.denyUrls&&e.denyUrls.forEach(function(e){t.match(e)&&(n=!0)}),n},this._formatUrl=function(t){try{return new global$1.URL(t,global$1.origin).href}catch(e){return t}}}return e.id="APIErrorIntegration",e}(),getCurrentHub$2=getCurrentHub$6,uuid4=uuid4$3,hub$1=getCurrentHub$6(),ResourceErrorIntegration=function(){function e(){this.name=e.id,this._handleDownLoadOnError=function(e){e={url:e.url,category:"downloadFile",errMsg:e.errMsg,eventId:uuid4(),statusCode:e.statusCode||"",timestamp:Date.now()};hub$1.captureEvent(__assign({},{resources:[e],type:"resource"}))}}return e.prototype.setupOnce=function(){addInstrumentationHandler({callback:this._handleDownLoadOnError,type:"resource"})},e.id="ResourceErrorIntegration",e}(),getCurrentHub$1=getCurrentHub$6,hub=getCurrentHub$6(),GlobalHandlers=function(){function e(){this.name=e.id,this._onErrorHandlerInstalled=!1}return e.prototype.setupOnce=function(){this._installGlobalOnErrorHandler()},e.prototype._installGlobalOnErrorHandler=function(){var c;this._onErrorHandlerInstalled||(c=MP.instance(),addInstrumentationHandler({callback:function(e){void 0===e&&(e=[""]);var t,n="",r="",o=/(((Eval|Reference|Range|Internal|Type|Syntax)Error)|promise)/;if("swan"===c.appName&&"[object String]"===Object.prototype.toString.call(e[0]))var i=e[0].replace(/\n/g,">>").split(">>"),n=i[1],r=i.splice(0,4).join("").match(o)[0];else{for(var s=0;s<3;s++)if(e[s]){if("[object Error]"===Object.prototype.toString.call(e[s])){r=e[s].name,n=e[s].message.replace(/\n/g," "),t=e[s].stack;break}n+=e[s].toString()}r||(r=(a=n.match(o))&&0<a.length?"promise"===a[0]?"UnhandledRejection":a[0]:"Error")}var a={errType:r,content:r+": "+n,stacktrace:t||e[0]};hub.captureEvent(__assign({},{exceptions:[a],type:"exception"}))},type:"error"}),this._onErrorHandlerInstalled=!0)},e.id="GlobalHandlersIntegration",e}(),DEFAULT_MAX_SPAN=100,DEFAULT_NAVIGATION_NAME="__beidou_pageload",timelineStructure=[{description:"SPAN0",startTimestamp:"in",endTimestamp:"App_onLaunch"},{description:"SPAN1",startTimestamp:"App_onLaunch",endTimestamp:"App_onShow"},{description:"SPAN2",startTimestamp:"Page_init",endTimestamp:"Page_onLoad"},{description:"SPAN3",startTimestamp:"Page_onLoad",endTimestamp:"Page_onShow"},{description:"SPAN4",startTimestamp:"Page_onShow",endTimestamp:"Page_onReady"}],timestampWithMs=timestampWithMs$1,isPlainObject=isPlainObject$2,SpanRecorder=function(){function e(){this.spans=[]}return e.prototype.add=function(e){this.spans.length>DEFAULT_MAX_SPAN?delete e.spanRecorder:this.spans.push(e)},e}(),Span=function(){function t(e){if(this.startTimestamp=timestampWithMs(),this.pageContexts=[],!e||!isPlainObject(e))return this;e.description&&(this.description=e.description),void 0!==e.startTimestamp&&(this.startTimestamp=e.startTimestamp),void 0!==e.endTimestamp&&(this.endTimestamp=e.endTimestamp)}return t.prototype.addPageContext=function(e){this.pageContexts.push(e)},t.prototype.child=function(e){return this.startChild(e)},t.prototype.startChild=function(e){e=new t(__assign({},e));return e.spanRecorder=this.spanRecorder,e.spanRecorder&&e.spanRecorder.add(e),e},t.prototype.finish=function(e){this.endTimestamp="number"==typeof e?e:timestampWithMs()},t}(),isInstanceOf=isInstanceOf$1,logger=logger$4,getCurrentHub=getCurrentHub$6,instance=null,Transaction=function(r){function n(e,t){var n=r.call(this,e)||this;return n._hub=getCurrentHub(),isInstanceOf(t,Hub)&&(n._hub=t),e.name&&(n.name=e.name),n}return __extends(n,r),n.prototype.setName=function(e){this.name=e},n.prototype.initSpanRecorder=function(){this.spanRecorder||(this.spanRecorder=new SpanRecorder),this.spanRecorder.add(this)},n.prototype.finish=function(e){var t=this;this.name||(logger.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this.name="<unlabeled transaction>"),r.prototype.finish.call(this,e);e=(this.spanRecorder?this.spanRecorder.spans.filter(function(e){return e!==t&&e.endTimestamp}):[]).map(function(e){return{description:e.description,endTimestamp:e.endTimestamp,startTimestamp:e.startTimestamp}});this._hub.captureEvent({performances:[{contexts:this.pageContexts,spans:e}],type:"performance"}),this.pageContexts=[],this.spanRecorder=new SpanRecorder},n.instance=function(e,t){return instance=instance||new n(e,t)},n}(Span);function _startChild(e,t){var n=t.startTimestamp,t=__rest(t,["startTimestamp"]);return n&&e.startTimestamp>n&&(e.startTimestamp=n),e.startChild(__assign({startTimestamp:n},t))}function addNavigationSpans(t,n){timelineStructure.forEach(function(e){_startChild(t,{description:e.description,startTimestamp:n[e.startTimestamp],endTimestamp:n[e.endTimestamp]})})}function addAppContexts(e,t){e.addPageContext({description:"READY0",time:t.ready-t.in,extra:encodeURIComponent(JSON.stringify(t.AppLaunch.extra))})}var vitals=null,MPVitals=function(){function e(){var n=this;this.interceptApp=function(){var o=n,i=MP.instance(),t=App;App=function(e){APP_LIFE_CYCLE.forEach(function(n){var r=e[n];e[n]=function(e){i.indexPage||(i.indexPage=e.path,i.networkInfo,i.userInfo);var t=Date.now()||(new Date).getTime();return console.log("App："+n+"_"+t),o.__TIMELINE__["App_"+n]=t,"onLaunch"===n&&(o._appLanch={layoutTime:t,extra:{name:"初始化耗时",scene:e.scene}},i.sceneInfo=e),"onShow"===n&&(o.__TIMELINE__.Page_init=t),r&&r.call(this,e)}}),t&&t.call(n,e)}},this.interceptPage=function(){var r=n,e="undefined"!=typeof process&&void 0!==process.env&&void 0!==process.env.TARO_ENV,t=e?Component:Page;e?Component=function(e){PAGE_LIFE_CYCLE.forEach(function(t){var n;"function"==typeof e.methods[t]&&(n=e.methods[t],e.methods[t]=function(e){return r.rewritePageLifeCycle(t,this,n,e)})}),t&&t.call(n,e)}:Page=function(e){PAGE_LIFE_CYCLE.forEach(function(t){var n=e[t];e[t]=function(e){return r.rewritePageLifeCycle(t,this,n,e)}}),t&&t.call(n,e)}},this.__TIMELINE__={in:Date.now()||(new Date).getTime()},this._appLanch=null,this._fpDown=!1,this.interceptApp(),this.interceptPage()}return e.prototype.rewritePageLifeCycle=function(e,t,n,r){var o=Date.now()||(new Date).getTime();return console.log("Page："+e+"_"+o),this.__TIMELINE__["Page_"+e]=o,"onHide"===e&&(this.__TIMELINE__.Page_init=o),"onReady"===e&&(e=Transaction.instance(),this._fpDown||(this.__TIMELINE__.ready=o,this._fpDown=!0),addNavigationSpans(e,this.__TIMELINE__),addAppContexts(e,__assign(__assign({},this.__TIMELINE__),{AppLaunch:this._appLanch})),e.finish()),n&&n.call(t,r)},e.instance=function(){return vitals=vitals||new e},e}(),MPTracing=function(){function e(){this.name=e.id}return e.prototype.setupOnce=function(e,t){this._getCurrentHub=t,this._createRouteTransaction()},e.prototype._createRouteTransaction=function(){var e;this._getCurrentHub?(e=this._getCurrentHub(),Transaction.instance({name:DEFAULT_NAVIGATION_NAME},e).initSpanRecorder(),MPVitals.instance()):logger$4.warn("hub 必须存在")},e.id="MPTracing",e}(),initAndBind=initAndBind$1,defaultIntegrations=[new Common,new GlobalHandlers,new ApiError,new ResourceErrorIntegration,new MPTracing];function init(e){(e=void 0===e?{url:""}:e).isDebug=!0,e.isProd=!0,e.defaultIntegrations=defaultIntegrations,initAndBind(MiniProgramClient,e)}exports.init=init;
